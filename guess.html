<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guessing Game</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    :root {
      --bg:#0b0c10; --panel:#151820; --text:#e8eef8; --muted:#a7b1c2;
      --accent:#4f9cf9; --accent-2:#22c55e; --warning:#f59e0b; --danger:#ef4444;
      --radius:16px;
    }
    @media (prefers-color-scheme: light) {
      :root { --bg:#f7f8fb; --panel:#fff; --text:#0f172a; --muted:#4b5563; }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:radial-gradient(1200px 800px at 70% -10%, rgba(79,156,249,.12), transparent), var(--bg);
      color:var(--text);display:grid;place-items:start center;padding:clamp(12px,2.5vw,24px)
    }
    .wrap{width:min(100%,720px);background:var(--panel);border-radius:var(--radius);
      box-shadow:0 10px 30px rgba(0,0,0,.18);padding:clamp(12px,3vw,22px);
      border:1px solid rgba(255,255,255,.06)
    }
    h1{margin:0 0 8px;font-size:clamp(1.2rem,2.4vw,1.6rem)}
    p.sub{margin:0 0 10px;color:var(--muted);font-size:.95rem}

    /* Controls */
    .grid{display:grid;gap:10px}
    @media(min-width:560px){.grid-3{grid-template-columns:repeat(3,1fr)} .grid-2{grid-template-columns:2fr 1fr}}
    label{display:block;font-size:.85rem;color:var(--muted);margin-bottom:6px}
    input[type="number"],input[type="text"]{
      width:100%;border:1px solid rgba(148,163,184,.3);background:rgba(255,255,255,.03);color:var(--text);
      padding:12px 14px;border-radius:12px;font-size:1rem;outline:none
    }
    input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(79,156,249,.15)}
    input[type=number]::-webkit-outer-spin-button,input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
    input[type=number]{-moz-appearance:textfield}
    .btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:600;font-size:1rem;cursor:pointer;background:var(--accent);color:#fff}
    .btn.secondary{background:transparent;border:1px solid rgba(148,163,184,.35);color:var(--text)}
    .btn:disabled{opacity:.55;cursor:not-allowed}

    /* Play grid under the input: left (feedback+status) | right (history) */
    .playgrid{
      display:grid; gap:10px; align-items:start; margin-top:10px;
      grid-template-columns: minmax(140px,1fr) minmax(140px,1fr);
    }
    @media (max-width:360px){ .playgrid{ grid-template-columns: 1fr 1fr; } }

    .feedback{
      display:inline-block; max-width:65%; padding:8px 10px; border-radius:999px;
      background:rgba(79,156,249,.1); border:1px solid rgba(79,156,249,.25);
      font-size:.95rem;
    }
    .feedback.warn{ background:rgba(245,158,11,.12); border-color:rgba(245,158,11,.35) }
    .feedback.bad { background:rgba(239,68,68,.12); border-color:rgba(239,68,68,.35) }
    .feedback.good{ background:rgba(34,197,94,.12); border-color:rgba(34,197,94,.35) }

    .status{display:grid;gap:8px;margin-top:6px}
    .pill{display:flex;gap:8px;padding:6px 10px;border-radius:999px;background:rgba(148,163,184,.12);color:var(--muted);width:fit-content}
    .pill strong{color:var(--text)}

    .history h3{margin:0 0 6px;font-size:1rem;color:var(--muted)}
    .history-list{
      margin:0; padding-left:0px; list-style-type:none; display:grid; gap:4px; max-height:32vh; overflow:auto; 
    }
    .history-list li{line-height:1.3}
    .history-list .lo,.history-list .hi{color:var(--warning)}
    .history-list .ok{color:var(--accent-2)}

    /* Collapsible settings kept out of the way during play */
    details.settings { margin-bottom: 8px; }
    details.settings[open]{ margin-bottom: 12px; }
    details.settings summary {
      list-style:none; cursor:pointer; user-select:none; padding:6px 8px; width:fit-content;
      color:var(--muted); border-radius:8px; border:1px solid rgba(148,163,184,.25); background:transparent;
    }
    details.settings summary::-webkit-details-marker{display:none}

    /* Tiny version chip */
    .version {
      position: fixed; right: 8px; bottom: 8px; opacity:.5; font-size:.78rem; color:var(--muted);
      background: rgba(0,0,0,.15); border:1px solid rgba(255,255,255,.08); border-radius:8px; padding:2px 6px;
      pointer-events:none;
    }

    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <main class="wrap" role="main">
    <h1>Guessing Game</h1>
    <p class="sub">Pick a range, set your attempts, then guess the number.</p>

    <!-- Collapsible: settings + new round -->
    <details class="settings" id="settings">
      <summary>Settings & New Round</summary>
      <div class="grid grid-3" style="margin-top:8px">
        <div>
          <label for="min-range">Minimum</label>
          <input id="min-range" type="number" inputmode="numeric" pattern="[0-9]*" placeholder="e.g., 1" step="1" />
        </div>
        <div>
          <label for="max-range">Maximum</label>
          <input id="max-range" type="number" inputmode="numeric" pattern="[0-9]*" placeholder="e.g., 100" step="1" />
        </div>
        <div>
          <label for="guesses">Attempts</label>
          <input id="guesses" type="number" inputmode="numeric" pattern="[0-9]*" placeholder="e.g., 8" min="1" step="1" />
        </div>
      </div>
      <div class="grid grid-2" style="margin-top:10px">
        <button id="start-game" class="btn" type="button">Start Game</button>
        <button id="new-round" class="btn secondary" type="button">New Round</button>
      </div>
    </details>

    <!-- Gameplay -->
    <section id="gameplay">
      <label class="sr-only" for="user-guess">Your Guess</label>
      <input id="user-guess" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="Enter a number" enterkeyhint="go" />
      <button id="guess" class="btn" type="button" disabled style="margin-top:8px">Guess</button>

      <div class="playgrid">
        <!-- Left: feedback + status -->
        <div class="left">
          <div id="feedback" class="feedback" hidden></div>
          <div class="status" aria-live="polite" aria-atomic="true">
            <div class="pill">Range: <strong id="range-val"></strong></div>
            <div class="pill">Attempts left: <strong id="attempts-val"></strong></div>
          </div>
        </div>

        <!-- Right: history (newest first) -->
        <aside class="right history" id="history" hidden>
          <h3>Guess history</h3>
          <ol id="history-list" class="history-list"></ol>
        </aside>
      </div>
    </section>
  </main>

  <div class="version">v1.3.4</div>

  <script>
    // ---- Element references ----
    const $ = (s) => document.querySelector(s);
    const settings = $('#settings');
    const minInput = $('#min-range');
    const maxInput = $('#max-range');
    const guessesInput = $('#guesses');
    const startBtn = $('#start-game');
    const newRoundBtn = $('#new-round');

    const userGuess = $('#user-guess');
    const guessBtn = $('#guess');

    const feedback = $('#feedback');
    const rangeVal = $('#range-val');
    const attemptsVal = $('#attempts-val');
    const historyEl = $('#history');
    const historyList = $('#history-list');

    // ---- State ----
    let secret = null, min = null, max = null;
    let attempts = 0, remaining = 0;
    let history = [];            // [{ value, relation }]
    let guessed = new Set();     // prevent duplicate guesses

    // ---- Helpers ----
    const setText = (el, t) => el.textContent = t;
    const randInt = (a,b) => Math.floor(Math.random()*(b-a+1))+a;

    function say(msg, tone='info'){
      feedback.className = 'feedback ' + (tone==='good'?'good':tone==='bad'?'bad':tone==='warn'?'warn':'');
      feedback.textContent = msg;
      feedback.hidden = false;
    }
    function focusGuess(select=true){
      userGuess.focus({ preventScroll:true });
      if(select) userGuess.select?.();
    }
    function clearAndFocus(){
      userGuess.value = '';
      guessBtn.disabled = true;
      focusGuess(true);
    }
    function renderHistory(){
      historyList.innerHTML = '';
      if(history.length === 0){ historyEl.hidden = true; return; }
      historyEl.hidden = false;
      // Newest first; NO numbering
      for(let i = history.length - 1; i >= 0; i--){
        const h = history[i];
        const li = document.createElement('li');
        li.className = h.relation; // 'lo' | 'hi' | 'ok'
        li.textContent = `${h.value} — ${h.relation==='lo'?'too low':h.relation==='hi'?'too high':'correct'}`;
        historyList.appendChild(li);
      }
      historyList.parentElement.scrollTop = 0; // keep newest visible
    }

    // Prevent accidental wheel changes on number inputs
    [minInput,maxInput,guessesInput].forEach(el=>{
      el.addEventListener('wheel', evt => el===document.activeElement && evt.preventDefault(), { passive:false });
    });

    // Guess button enablement and Enter-to-guess
    userGuess.addEventListener('input', () => { guessBtn.disabled = userGuess.value.trim() === ''; });
    userGuess.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && !guessBtn.disabled){ e.preventDefault(); handleGuess(); } });
    guessBtn.addEventListener('click', handleGuess);

    // ---- Start Game (no URL params; no form submit) ----
    startBtn.addEventListener('click', () => {
      const minVal = parseInt(minInput.value,10);
      const maxVal = parseInt(maxInput.value,10);
      const tries  = parseInt(guessesInput.value,10);

      if(Number.isNaN(minVal) || Number.isNaN(maxVal) || Number.isNaN(tries)){ say('Fill all fields with valid numbers.', 'warn'); return; }
      if(tries < 1){ say('Attempts must be at least 1.', 'warn'); return; }

      min = Math.min(minVal, maxVal);
      max = Math.max(minVal, maxVal);
      attempts = tries;
      remaining = tries;
      secret = randInt(min, max);

      history = []; guessed = new Set();
      setText(rangeVal, `${min} – ${max}`); // always static min–max
      setText(attemptsVal, remaining);
      feedback.hidden = true;
      renderHistory();

      // Collapse settings to free space; show only play UI
      settings.open = false;
      clearAndFocus();
    });

    // New round with same settings
    newRoundBtn.addEventListener('click', ()=>{
      if(min==null || max==null || attempts==null){ say('Start a game first.', 'warn'); return; }
      secret = randInt(min, max);
      remaining = attempts;
      history = []; guessed = new Set();
      setText(rangeVal, `${min} – ${max}`);
      setText(attemptsVal, remaining);
      feedback.hidden = true;
      renderHistory();
      settings.open = false;
      clearAndFocus();
      say('New round ready.');
    });

    function handleGuess(){
      const raw = userGuess.value.trim();
      if(raw==='') return;
      const val = parseInt(raw,10);
      if(Number.isNaN(val)){ say('Numbers only.', 'warn'); clearAndFocus(); return; }
      if(val < min || val > max){ say(`Stay in range: ${min} – ${max}.`, 'warn'); clearAndFocus(); return; }
      if(guessed.has(val)){ say(`Already tried ${val}. Pick a new number.`, 'warn'); clearAndFocus(); return; }
      guessed.add(val);

      remaining -= 1;
      setText(attemptsVal, Math.max(remaining,0));

      if(val === secret){
        history.push({ value: val, relation: 'ok' });
        renderHistory();
        say(`Correct: ${val}.`, 'good');

        // Auto-arm a new secret
        secret = randInt(min, max);
        remaining = attempts;
        setText(rangeVal, `${min} – ${max}`);
        setText(attemptsVal, remaining);
        history = []; guessed = new Set();
        renderHistory();
        clearAndFocus();
        return;
      }

      if(remaining <= 0){
        history.push({ value: val, relation: val < secret ? 'lo' : 'hi' });
        renderHistory();
        say(`Out of attempts. It was ${secret}. New round armed.`, 'bad');

        secret = randInt(min, max);
        remaining = attempts;
        setText(rangeVal, `${min} – ${max}`);
        setText(attemptsVal, remaining);
        history = []; guessed = new Set();
        renderHistory();
        clearAndFocus();
        return;
      }

      // Mid-round feedback (no tries text here—Attempts left pill already shows it)
      history.push({ value: val, relation: val < secret ? 'lo' : 'hi' });
      renderHistory();
      say(val < secret ? 'Too low.' : 'Too high.', 'warn');
      clearAndFocus();
    }

    // Friendly defaults (1–100, 8 attempts)
    window.addEventListener('DOMContentLoaded', ()=>{
      if(!minInput.value) minInput.value = 1;
      if(!maxInput.value) maxInput.value = 100;
      if(!guessesInput.value) guessesInput.value = 8;
    });
  </script>
</body>
</html>
